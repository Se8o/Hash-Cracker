<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parallel Hash Cracking Engine</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .section {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #444;
            font-weight: 500;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        textarea {
            resize: vertical;
            min-height: 120px;
            font-family: 'Courier New', monospace;
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        button {
            background: #007bff;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            width: 100%;
            margin-top: 10px;
        }

        button:hover {
            background: #0056b3;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .output {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            display: none;
        }

        .output.visible {
            display: block;
        }

        .status {
            padding: 10px;
            border-radius: 4px;
            margin-top: 15px;
            display: none;
        }

        .status.visible {
            display: block;
        }

        .status.running {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .status.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #007bff;
            padding: 12px;
            margin-bottom: 20px;
            font-size: 13px;
        }

        .results {
            margin-top: 20px;
        }

        .result-item {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .result-item strong {
            color: #007bff;
        }

        .file-info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Parallel Hash Cracking Engine</h1>
        <p class="subtitle">Paralelní nástroj pro vyhledávání hashů pomocí multiprocessing</p>

        <div class="info-box">
            <strong>Jak to funguje:</strong> Nahrajte CSV soubor s daty (každý řádek = jedna hodnota).
            Program paralelně vypočítá hashe a porovná je s hledaným hashem.
        </div>

        <form id="hashForm">
            <div class="section">
                <label for="csvData">CSV Data (jeden záznam na řádek):</label>
                <textarea id="csvData" placeholder="test&#10;hello&#10;world&#10;password&#10;admin"></textarea>
                <div class="file-info">Nebo vyberte existující soubor: data/sample_data.csv, data/birth_numbers.csv</div>
            </div>

            <div class="section">
                <label for="targetHash">Hledaný hash:</label>
                <input type="text" id="targetHash" placeholder="9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08">
            </div>

            <div class="row">
                <div class="section">
                    <label for="algorithm">Algoritmus:</label>
                    <select id="algorithm">
                        <option value="SHA256">SHA256 (64 znaků)</option>
                        <option value="SHA384">SHA384 (96 znaků)</option>
                        <option value="SHA512">SHA512 (128 znaků)</option>
                        <option value="PBKDF2">PBKDF2-HMAC</option>
                    </select>
                </div>

                <div class="section">
                    <label for="workers">Počet workerů:</label>
                    <input type="number" id="workers" value="4" min="1" max="16">
                </div>
            </div>

            <div class="row">
                <div class="section">
                    <label for="chunkSize">Chunk size:</label>
                    <input type="number" id="chunkSize" value="10000" min="100" max="100000">
                </div>

                <div class="section">
                    <label for="timeout">Timeout (s):</label>
                    <input type="number" id="timeout" value="300" min="10" max="3600">
                </div>
            </div>

            <button type="submit" id="runBtn">Spustit vyhledávání</button>
        </form>

        <div id="status" class="status"></div>

        <div id="output" class="output"></div>

        <div id="results" class="results"></div>
    </div>

    <script>
        const form = document.getElementById('hashForm');
        const output = document.getElementById('output');
        const status = document.getElementById('status');
        const results = document.getElementById('results');
        const runBtn = document.getElementById('runBtn');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const csvData = document.getElementById('csvData').value.trim();
            const targetHash = document.getElementById('targetHash').value.trim();
            let algorithm = document.getElementById('algorithm').value;
            const workers = parseInt(document.getElementById('workers').value);
            const chunkSize = parseInt(document.getElementById('chunkSize').value);
            const timeout = parseInt(document.getElementById('timeout').value);

            if (!csvData) {
                showStatus('error', 'Prosím zadejte CSV data');
                return;
            }

            if (!targetHash) {
                showStatus('error', 'Prosím zadejte hledaný hash');
                return;
            }

            // Auto-detect algorithm based on hash length
            if (targetHash.length === 64) {
                algorithm = 'SHA256';
            } else if (targetHash.length === 96) {
                algorithm = 'SHA384';
            } else if (targetHash.length === 128) {
                algorithm = 'SHA512';
            }

            runBtn.disabled = true;
            showStatus('running', 'Spouštím paralelní zpracování...');
            output.classList.add('visible');
            output.textContent = 'Inicializace...\n';
            results.innerHTML = '';

            const config = {
                general: {
                    worker_count: workers,
                    chunk_size: chunkSize,
                    max_workers: 8,
                    timeout_seconds: timeout
                },
                hash: {
                    algorithm: algorithm,
                    pbkdf2_iterations: 100000,
                    pbkdf2_salt_length: 32
                },
                input: {
                    csv_path: 'temp_input.csv',
                    csv_encoding: 'utf-8',
                    csv_delimiter: ','
                },
                output: {
                    log_path: 'logs/web_hasher.log',
                    results_path: 'logs/web_results.json',
                    verbose: true
                },
                target: {
                    hash_to_find: targetHash
                }
            };

            try {
                const response = await fetch('/api/run', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        csv_data: csvData,
                        config: config
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showStatus('success', `Dokončeno! Nalezeno ${data.matches_found} shod za ${data.time.toFixed(2)}s`);
                    output.textContent += '\n' + data.log;
                    
                    if (data.results && data.results.length > 0) {
                        displayResults(data.results, data.stats);
                    }
                } else {
                    showStatus('error', 'Chyba: ' + data.error);
                    output.textContent += '\nERROR: ' + data.error;
                }
            } catch (error) {
                showStatus('error', 'Chyba spojení se serverem');
                output.textContent += '\nChyba: ' + error.message;
            }

            runBtn.disabled = false;
        });

        function showStatus(type, message) {
            status.className = 'status visible ' + type;
            status.textContent = message;
        }

        function displayResults(resultsData, stats) {
            let html = '<h3>Výsledky:</h3>';
            
            if (stats) {
                html += `<div class="info-box">
                    <strong>Statistiky:</strong><br>
                    Zpracováno záznamů: ${stats.total_items}<br>
                    Nalezeno shod: ${stats.matches_found}<br>
                    Čas zpracování: ${stats.total_time.toFixed(2)}s<br>
                    Rychlost: ${stats.rate.toFixed(2)} položek/s
                </div>`;
            }

            resultsData.forEach((result, index) => {
                html += `<div class="result-item">
                    <strong>Shoda #${index + 1}</strong><br>
                    Původní hodnota: <code>${result.original}</code><br>
                    Hash: <code>${result.hash}</code><br>
                    Worker: ${result.worker_id} | Algoritmus: ${result.algorithm}
                </div>`;
            });

            results.innerHTML = html;
        }

        // Příklad preset
        document.getElementById('targetHash').value = '9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08';
        document.getElementById('csvData').value = 'test\nhello\nworld\npassword\nadmin';
        document.getElementById('algorithm').value = 'SHA256';

        // Auto-update algorithm when hash changes
        document.getElementById('targetHash').addEventListener('input', function() {
            const hash = this.value.trim();
            const algoSelect = document.getElementById('algorithm');
            
            if (hash.length === 64) {
                algoSelect.value = 'SHA256';
            } else if (hash.length === 96) {
                algoSelect.value = 'SHA384';
            } else if (hash.length === 128) {
                algoSelect.value = 'SHA512';
            }
        });
    </script>
</body>
</html>
